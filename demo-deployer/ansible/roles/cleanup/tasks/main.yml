---
# Role: cleanup — remove o namespace inteiro (e todos os recursos dentro)
- name: "Deletar projeto/namespace {{ namespace }}"
  command: "oc delete project {{ namespace }} --ignore-not-found=true"
  register: delete_result
  failed_when: false

- name: "Aguardar exclusão do namespace {{ namespace }}"
  command: "oc get project {{ namespace }}"
  register: ns_check
  until: ns_check.rc != 0
  retries: 30
  delay: 5
  failed_when: false
  changed_when: false
  when: delete_result.rc == 0

- name: "Registrar resultado do cleanup"
  set_fact:
    cleanup_result:
      namespace: "{{ namespace }}"
      status: "deleted"
